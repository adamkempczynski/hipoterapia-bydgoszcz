---
import MainLayout from '../layouts/MainLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import ScrollReveal from '../components/ScrollReveal.astro';
import WaveDivider from '../components/WaveDivider.astro';

import heroImage from '../assets/hero-image-v2.webp';

const allPosts = await getCollection('aktualnosci');

const sortedPosts = allPosts.sort((
    a: CollectionEntry<'aktualnosci'>,
    b: CollectionEntry<'aktualnosci'>
) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const categoryColors: Record<string, { bg: string; text: string }> = {
	'biwaki-wycieczki': { bg: 'bg-primary-100', text: 'text-primary-800' },
	'wydarzenia-sportowe': { bg: 'bg-blue-100', text: 'text-blue-800' },
	'zebrania-organizacyjne': { bg: 'bg-gray-100', text: 'text-gray-700' },
	'wydarzenia-spoleczne': { bg: 'bg-accent-100', text: 'text-accent-800' },
	'programy-dotacyjne': { bg: 'bg-secondary-100', text: 'text-secondary-800' },
};

function getCategoryStyle(category?: string) {
	if (!category) return { bg: 'bg-primary-100', text: 'text-primary-800' };
	return categoryColors[category] || { bg: 'bg-primary-100', text: 'text-primary-800' };
}
---

<MainLayout title="Strona Główna">
	<!-- Hero Section -->
	<section class="relative min-h-[70vh] md:min-h-[80vh] overflow-hidden">
		<Image
			src={heroImage}
			alt="Uśmiechnięty uczestnik hipoterapii podczas zajęć z koniem w Bydgoszczy"
			class="absolute inset-0 w-full h-full object-cover brightness-110 saturate-[1.05]"
		/>
		<div class="absolute inset-0 bg-gradient-to-r from-black/70 via-black/40 to-transparent"></div>
		<div class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent"></div>

		<!-- Decorative blob -->
		<div class="absolute top-1/4 right-10 w-72 h-72 bg-primary-400/20 rounded-blob blur-2xl hidden lg:block animate-float pointer-events-none"></div>

		<div class="relative z-10 h-full min-h-[70vh] md:min-h-[80vh] flex items-center">
			<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full">
				<div class="max-w-2xl">
					<h1 class="font-display text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold text-white mb-6 animate-fade-in leading-tight">
						Terapia, która daje <span class="text-accent-400">radość</span>
					</h1>
					<p class="text-lg sm:text-xl md:text-2xl text-gray-200 mb-10 font-light animate-slide-up leading-relaxed">
						Odkryj moc hipoterapii w profesjonalnym i przyjaznym otoczeniu. Pomagamy dzieciom i dorosłym rozwijać się przez kontakt z końmi.
					</p>
					<div class="flex flex-col sm:flex-row gap-4 animate-slide-up">
						<a href="/oferta/" class="btn btn-primary px-8 py-4 text-lg rounded-xl">
							Zobacz ofertę
						</a>
						<a href="/kontakt/" class="btn bg-white/15 hover:bg-white/25 text-white border border-white/30 px-8 py-4 text-lg rounded-xl backdrop-blur-sm">
							Skontaktuj się
						</a>
					</div>
				</div>
			</div>
		</div>

		<WaveDivider position="bottom" color="#f0f7f2" />
	</section>

	<!-- Features Section -->
	<section class="py-20 md:py-28 bg-primary-50 relative overflow-hidden">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
			<ScrollReveal animation="up" class="text-center mb-16">
				<h2 class="section-heading mb-4">
					Dlaczego <span class="text-gradient">hipoterapia</span>?
				</h2>
				<p class="text-lg text-gray-600 max-w-3xl mx-auto leading-relaxed">
					Hipoterapia to innowacyjna metoda rehabilitacji wykorzystująca ruch konia do poprawy funkcjonowania fizycznego i psychicznego.
				</p>
			</ScrollReveal>

			<div class="grid grid-cols-1 md:grid-cols-3 gap-8 lg:gap-10">
				<ScrollReveal animation="up" delay={0}>
					<div class="card-warm text-center p-8 md:p-10 group h-full">
						<div class="w-20 h-20 bg-gradient-to-br from-primary-400 to-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg group-hover:scale-110 transition-transform duration-300">
							<svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
							</svg>
						</div>
						<h3 class="text-xl font-semibold text-gray-900 mb-4">Profesjonalna opieka</h3>
						<p class="text-gray-600 leading-relaxed">
							Doświadczeni terapeuci i instruktorzy zapewniają bezpieczną i skuteczną terapię dostosowaną do indywidualnych potrzeb.
						</p>
					</div>
				</ScrollReveal>

				<ScrollReveal animation="up" delay={150}>
					<div class="card-warm text-center p-8 md:p-10 group h-full">
						<div class="w-20 h-20 bg-gradient-to-br from-primary-400 to-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg group-hover:scale-110 transition-transform duration-300">
							<svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
							</svg>
						</div>
						<h3 class="text-xl font-semibold text-gray-900 mb-4">Skuteczne efekty</h3>
						<p class="text-gray-600 leading-relaxed">
							Poprawa równowagi, koordynacji, siły mięśniowej oraz rozwój umiejętności społecznych i emocjonalnych.
						</p>
					</div>
				</ScrollReveal>

				<ScrollReveal animation="up" delay={300}>
					<div class="card-warm text-center p-8 md:p-10 group h-full">
						<div class="w-20 h-20 bg-gradient-to-br from-primary-400 to-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg group-hover:scale-110 transition-transform duration-300">
							<svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
							</svg>
						</div>
						<h3 class="text-xl font-semibold text-gray-900 mb-4">Indywidualne podejście</h3>
						<p class="text-gray-600 leading-relaxed">
							Każda sesja jest dostosowana do wieku, możliwości i celów terapeutycznych uczestnika.
						</p>
					</div>
				</ScrollReveal>
			</div>
		</div>

		<WaveDivider position="bottom" color="#ffffff" />
	</section>

	<!-- Trust Strip Section -->
	<section class="py-12 bg-white">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<ScrollReveal animation="up">
				<div class="flex flex-wrap justify-center gap-6 md:gap-10 lg:gap-16">
					<div class="flex items-center gap-3">
						<div class="w-12 h-12 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0">
							<svg class="w-6 h-6 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
							</svg>
						</div>
						<div>
							<p class="font-bold text-lg text-gray-900">Od 1995 roku</p>
							<p class="text-sm text-gray-500">Ponad 30 lat doświadczenia</p>
						</div>
					</div>

					<div class="flex items-center gap-3">
						<div class="w-12 h-12 rounded-full bg-accent-100 flex items-center justify-center flex-shrink-0">
							<svg class="w-6 h-6 text-accent-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
							</svg>
						</div>
						<div>
							<p class="font-bold text-lg text-gray-900">OPP</p>
							<p class="text-sm text-gray-500">Organizacja Pożytku Publicznego</p>
						</div>
					</div>

					<div class="flex items-center gap-3">
						<div class="w-12 h-12 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0">
							<svg class="w-6 h-6 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
							</svg>
						</div>
						<div>
							<p class="font-bold text-lg text-gray-900">Patronat PTHip</p>
							<p class="text-sm text-gray-500">Polskie Towarzystwo Hipoterapeutyczne</p>
						</div>
					</div>

					<div class="flex items-center gap-3">
						<div class="w-12 h-12 rounded-full bg-accent-100 flex items-center justify-center flex-shrink-0">
							<svg class="w-6 h-6 text-accent-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
							</svg>
						</div>
						<div>
							<p class="font-bold text-lg text-gray-900">1,5% podatku</p>
							<p class="text-sm text-gray-500">KRS: 0000120586</p>
						</div>
					</div>
				</div>
			</ScrollReveal>
		</div>
	</section>

	<!-- News Section -->
	<section class="py-20 bg-white relative">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<ScrollReveal animation="up">
				<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-12 gap-4">
					<div>
						<h2 class="section-heading mb-2">
							Ostatnie <span class="text-gradient">aktualności</span>
						</h2>
						<p class="text-gray-600">Poznaj najnowsze wydarzenia z naszego ośrodka</p>
					</div>
					<a href="/aktualnosci/" class="btn bg-primary-600 hover:bg-primary-700 text-white inline-flex items-center rounded-xl">
						Wszystkie aktualności
						<svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
						</svg>
					</a>
				</div>
			</ScrollReveal>

			{/* Featured Post - Hero Card */}
			{sortedPosts.length > 0 && (
				<ScrollReveal animation="up" delay={100}>
					<article class="card overflow-hidden mb-12 group hover:shadow-2xl transition-all duration-300">
						<div class="grid md:grid-cols-2 gap-0">
							{/* Image Section */}
							<div class="relative h-72 md:h-96 overflow-hidden">
								{sortedPosts[0].data.gallery && sortedPosts[0].data.gallery.length > 0 ? (
									<img
										src={sortedPosts[0].data.gallery[0]}
										alt={sortedPosts[0].data.title}
										loading="eager"
										class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
									/>
								) : (
									<div class="w-full h-full bg-gradient-to-br from-primary-500 to-primary-700 flex items-center justify-center">
										<img src="/uploads/logos/logo_bw.webp" alt="" class="w-24 h-24 opacity-20" />
									</div>
								)}
								<div class="absolute top-4 left-4 z-10">
									<span class="inline-block px-4 py-2 bg-accent-500 text-white text-xs font-bold uppercase tracking-wide rounded-full shadow-lg">
										Najnowsze
									</span>
								</div>
							</div>

							{/* Content Section */}
							<div class="p-8 md:p-10 flex flex-col justify-center">
								<div class="mb-4">
									{sortedPosts[0].data.category && (() => {
										const style = getCategoryStyle(sortedPosts[0].data.category);
										return (
											<span class:list={['inline-block px-3 py-1 text-sm font-medium rounded-full mb-4', style.bg, style.text]}>
												{sortedPosts[0].data.category}
											</span>
										);
									})()}
									<h3 class="text-2xl md:text-3xl font-bold text-gray-900 mb-4 group-hover:text-primary-600 transition-colors">
										<a href={`/aktualnosci/wpis/${sortedPosts[0].slug}/`}>
											{sortedPosts[0].data.title}
										</a>
									</h3>
									<p class="text-sm text-gray-500 mb-4 flex items-center">
										<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
										</svg>
										{sortedPosts[0].data.pubDate.toLocaleDateString('pl-PL', {
											day: 'numeric',
											month: 'long',
											year: 'numeric'
										})}
									</p>
								</div>
								{sortedPosts[0].data.description && (
									<p class="text-gray-600 text-lg mb-6 line-clamp-3 leading-relaxed">
										{sortedPosts[0].data.description}
									</p>
								)}
								<a
									href={`/aktualnosci/wpis/${sortedPosts[0].slug}/`}
									class="inline-flex items-center text-primary-600 hover:text-primary-700 font-semibold text-lg transition-all group-hover:gap-3 gap-2"
								>
									Czytaj więcej
									<svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
									</svg>
								</a>
							</div>
						</div>
					</article>
				</ScrollReveal>
			)}

			{/* Other Posts Grid */}
			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
				{sortedPosts.slice(1, 4).map((post: CollectionEntry<'aktualnosci'>, index: number) => (
					<ScrollReveal animation="up" delay={index * 100}>
						<article class="card overflow-hidden group hover:shadow-xl transition-all duration-300 h-full bg-white">
							{post.data.image ? (
								<div class="overflow-hidden">
									<img
										src={post.data.image}
										alt={post.data.title}
										loading="lazy"
										class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"
									/>
								</div>
							) : post.data.gallery && post.data.gallery.length > 0 ? (
								<div class="overflow-hidden">
									<img
										src={post.data.gallery[0]}
										alt={post.data.title}
										loading="lazy"
										class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"
									/>
								</div>
							) : null}
							<div class="p-6">
								<div class="mb-4">
									{post.data.category && (
										<span class:list={['inline-block px-3 py-1 text-sm font-medium rounded-full mb-3', getCategoryStyle(post.data.category).bg, getCategoryStyle(post.data.category).text]}>
											{post.data.category}
										</span>
									)}
									<h3 class="text-xl font-semibold text-gray-900 mb-3 group-hover:text-primary-600 transition-colors">
										<a href={`/aktualnosci/wpis/${post.slug}/`}>{post.data.title}</a>
									</h3>
									<p class="text-sm text-gray-500 mb-3 flex items-center">
										<svg class="w-4 h-4 mr-1.5 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
										</svg>
										{post.data.pubDate.toLocaleDateString('pl-PL', {
											day: 'numeric',
											month: 'long',
											year: 'numeric'
										})}
									</p>
								</div>
								{post.data.description && (
									<p class="text-gray-600 mb-4 line-clamp-3">{post.data.description}</p>
								)}
								<a
									href={`/aktualnosci/wpis/${post.slug}/`}
									class="inline-flex items-center text-primary-600 hover:text-primary-700 font-medium transition-all group-hover:gap-2 gap-1"
								>
									Czytaj więcej
									<svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
									</svg>
								</a>
							</div>
						</article>
					</ScrollReveal>
				))}
			</div>
		</div>
	</section>

	<!-- CTA Section -->
	<section class="py-20 md:py-28 bg-gradient-to-br from-primary-700 via-primary-800 to-primary-900 relative overflow-hidden">
		<WaveDivider position="top" color="#ffffff" />

		<!-- Decorative elements -->
		<div class="absolute inset-0 opacity-10 pointer-events-none">
			<div class="absolute top-10 right-10 w-96 h-96 bg-white rounded-full blur-3xl"></div>
			<div class="absolute bottom-10 left-10 w-72 h-72 bg-accent-400 rounded-full blur-3xl"></div>
		</div>

		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
			<ScrollReveal animation="up">
				<div class="text-center">
					<h2 class="font-display text-3xl md:text-5xl font-bold text-white mb-6">
						Gotowy na pierwszy krok?
					</h2>
					<p class="text-xl text-primary-200 mb-10 max-w-2xl mx-auto leading-relaxed">
						Skontaktuj się z nami, aby umówić konsultację i dowiedzieć się więcej o możliwościach hipoterapii.
					</p>
					<div class="flex flex-col sm:flex-row gap-4 justify-center">
						<a href="/kontakt/" class="btn btn-primary px-8 py-4 text-lg rounded-xl font-semibold shadow-xl hover:shadow-2xl hover:scale-105 transition-all duration-300">
							Skontaktuj się z nami
						</a>
						<a href="/oferta/" class="btn bg-white/15 hover:bg-white/25 text-white px-8 py-4 text-lg font-semibold border border-white/30 hover:border-white/50 rounded-xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all duration-300">
							Poznaj pełną ofertę
						</a>
					</div>
				</div>
			</ScrollReveal>
		</div>
	</section>
</MainLayout>

<style>
	.line-clamp-3 {
		display: -webkit-box;
		-webkit-line-clamp: 3;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
</style>
