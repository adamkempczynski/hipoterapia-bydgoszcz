---
import MainLayout from '../../layouts/MainLayout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('aktualnosci');

// Grupowanie postów według lat
const postsByYear = allPosts.reduce((acc, post) => {
  const year = post.data.pubDate.getFullYear();
  if (!acc[year]) {
    acc[year] = [];
  }
  acc[year].push(post);
  return acc;
}, {} as Record<number, typeof allPosts>);

// Sortowanie lat malejąco
const sortedYears = Object.keys(postsByYear)
  .map(year => parseInt(year))
  .sort((a, b) => b - a);

// Kategorie wydarzeń
const categories = {
  'biwaki-wycieczki': 'Biwaki i wycieczki',
  'wydarzenia-sportowe': 'Wydarzenia sportowe',
  'zebrania-organizacyjne': 'Zebrania i sprawy organizacyjne',
  'wydarzenia-spoleczne': 'Wydarzenia społeczne',
  'programy-dotacyjne': 'Programy dotacyjne'
};
---

<MainLayout title="Aktualności - Archiwum">
  <!-- Header Section -->
  <section class="py-12 bg-gradient-to-r from-primary-600 to-primary-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">
        Archiwum <span class="text-primary-200">Aktualności</span>
      </h1>
      <p class="text-xl text-primary-100 max-w-3xl mx-auto">
        Wszystkie wydarzenia i aktualności organizowane przez Bydgoskie Towarzystwo Hipoterapii i Psychoterapii, uporządkowane według lat i kategorii.
      </p>
    </div>
  </section>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Year Navigation -->
    <section class="mb-12">
      <div class="card p-8">
        <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-6 flex items-center">
          <svg class="w-8 h-8 text-primary-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          Przeglądaj według lat
        </h2>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
          {sortedYears.map(year => (
            <a
              href={`/aktualnosci/${year}/`}
              class="group relative bg-gradient-to-br from-primary-50 to-primary-100 hover:from-primary-100 hover:to-primary-200 rounded-xl p-6 text-center transition-all duration-300 hover:shadow-lg hover:-translate-y-1"
            >
              <div class="text-2xl font-bold text-primary-700 mb-2">{year}</div>
              <div class="text-sm text-primary-600">
                {postsByYear[year].length} {postsByYear[year].length === 1 ? 'wpis' : postsByYear[year].length < 5 ? 'wpisy' : 'wpisów'}
              </div>
              <div class="absolute inset-0 bg-primary-600 opacity-0 group-hover:opacity-10 rounded-xl transition-opacity duration-300"></div>
            </a>
          ))}
        </div>
      </div>
    </section>

    <!-- Category Navigation -->
    <section class="mb-12">
      <div class="card p-8">
        <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-6 flex items-center">
          <svg class="w-8 h-8 text-primary-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
          </svg>
          Przeglądaj według kategorii
        </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          {Object.entries(categories).map(([key, name]) => {
            const categoryPosts = allPosts.filter(post => post.data.category === key);
            return categoryPosts.length > 0 ? (
              <a
                href={`/aktualnosci/kategoria/${key}/`}
                class="group bg-white hover:bg-gray-50 border-2 border-gray-200 hover:border-primary-300 rounded-xl p-6 transition-all duration-300 hover:shadow-md"
              >
                <div class="flex items-center justify-between">
                  <div>
                    <h3 class="font-semibold text-gray-900 group-hover:text-primary-700 transition-colors">{name}</h3>
                    <p class="text-sm text-gray-500 mt-1">{categoryPosts.length} {categoryPosts.length === 1 ? 'wydarzenie' : 'wydarzeń'}</p>
                  </div>
                  <svg class="w-5 h-5 text-gray-400 group-hover:text-primary-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                </div>
              </a>
            ) : null;
          })}
        </div>
      </div>
    </section>

    <!-- Recent Posts -->
    <section>
      <div class="card p-8">
        <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-8 flex items-center">
          <svg class="w-8 h-8 text-primary-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          Najnowsze aktualności
        </h2>
        <div class="space-y-6">
          {allPosts
            .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
            .slice(0, 8)
            .map(post => (
              <article class="group border-l-4 border-primary-200 hover:border-primary-500 bg-gray-50 hover:bg-white rounded-r-lg p-6 transition-all duration-300 hover:shadow-md">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                  <div class="flex-1">
                    <h3 class="text-xl font-semibold text-gray-900 group-hover:text-primary-700 transition-colors mb-2">
                      <a href={`/aktualnosci/wpis/${post.slug}/`} class="text-decoration-none">{post.data.title}</a>
                    </h3>
                    <div class="flex flex-wrap items-center gap-4 mb-3">
                      <time class="text-sm text-gray-500 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        {post.data.pubDate.toLocaleDateString('pl-PL', {
                          day: 'numeric',
                          month: 'long',
                          year: 'numeric'
                        })}
                      </time>
                      {post.data.category && (
                        <span class="inline-flex items-center px-3 py-1 bg-primary-100 text-primary-800 text-sm font-medium rounded-full">
                          {categories[post.data.category]}
                        </span>
                      )}
                    </div>
                    {post.data.description && (
                      <p class="text-gray-600 line-clamp-2">{post.data.description}</p>
                    )}
                  </div>
                  <div class="flex-shrink-0">
                    <a
                      href={`/aktualnosci/wpis/${post.slug}/`}
                      class="inline-flex items-center px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-colors"
                    >
                      Czytaj
                      <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                      </svg>
                    </a>
                  </div>
                </div>
              </article>
            ))
          }
        </div>

        <div class="mt-8 text-center">
          <p class="text-gray-600 mb-4">Chcesz zobaczyć więcej? Przeglądaj według lat lub kategorii powyżej.</p>
        </div>
      </div>
    </section>
  </div>
</MainLayout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .text-decoration-none {
    text-decoration: none;
  }
</style>